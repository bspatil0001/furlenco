'use strict';
/**
 * @ngdoc function
 * @name workplace.controller:AllReviewsController
 * @description
 * # AllReviewsController
 * Controller of the workplace
 */
angular.module('workplace')
  .controller('AllReviewsController', function ($stateParams, serrviceConnectorFactory) {
    let vm = this;
    vm.total = undefined;
    vm.reviews = [];

    $.fn.isFullyInViewport = function () {
      let elementTop = $(this).offset().top;
      let elementBottom = elementTop + $(this).outerHeight();
      let viewportTop = $(window).scrollTop();
      let viewportBottom = viewportTop + $(window).height();
      return elementTop >= viewportTop && elementBottom <= viewportBottom;
    };

    function populateData(){
      console.log(vm.reviews)
      let temp = vm.reviews.slice(0,5)
      vm.reviews = vm.reviews.concat(temp);
    }

    function getReviews() {
      serrviceConnectorFactory.getRestaurantReviews({
        res_id: $stateParams.restaurantid,
        start: 0,
        count: 10
      }, {}, function (data) {
        vm.reviews = vm.reviews.concat(data.user_reviews);
        console.log(vm.reviews.length)
        // if(!vm.total || vm.reviews.length < 20){
        //   populateData()
        // }
      })
    }

    if (!vm.total || vm.reviews.length < 100) {
      getReviews();
      $(window).on('resize scroll', function () {
        $('.last').is(function () {
          if ($(this).isFullyInViewport()) {
            if (!vm.total && vm.reviews.length <= 100) {
              populateData();              
            }
          }
        })
      });
    }


  });
